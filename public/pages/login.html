<div class="flex flex-col items-center justify-center px-4 py-16 min-h-[70vh]">
  <div class="card w-full max-w-md bg-white shadow-xl border border-gray-200">
    <div class="card-body p-8">
      <h2 class="text-3xl font-bold text-center text-custom-blue mb-4">
        Login
      </h2>

      <p class="text-center text-gray-600 mb-6">
        Masukkan nomor telepon Anda untuk melanjutkan
      </p>

      <form id="loginForm">
        <div class="form-control mb-4">
          <label class="label">
            <span class="label-text font-medium text-gray-700"
              >Nomor Telepon</span
            >
          </label>
          <input
            type="tel"
            id="phoneNumber"
            placeholder="+628123456789"
            class="input input-bordered w-full bg-white text-black"
            required
          />
        </div>

        <div class="form-control mt-6">
          <button
            type="submit"
            class="btn bg-custom-blue text-white hover:bg-opacity-90 border-none rounded-full py-3 text-base font-medium"
          >
            Lanjutkan
            <span
              class="loading loading-spinner loading-sm hidden"
              id="loginSpinner"
            ></span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const phoneNumber = document.getElementById("phoneNumber").value;
    const spinner = document.getElementById("loginSpinner");
    const submitBtn = e.target.querySelector('button[type="submit"]');

    spinner.classList.remove("hidden");
    submitBtn.disabled = true;

    try {
      // API, Auth, dan router tersedia secara global dari app.js
      const response = await API.login(phoneNumber);
      if (response.success) {
        Auth.setToken(response.token);

        // Memanggil fungsi global untuk update navbar secara instan
        if (typeof updateNavbarAuth === "function") {
          updateNavbarAuth();
        }

        if (response.user.hasQuestionnaire) {
          router.navigate("/");
        } else {
          router.navigate("/questionnaire");
        }
      } else {
        alert("Login gagal. Silakan coba lagi.");
      }
    } catch (error) {
      alert("Terjadi kesalahan. Silakan coba lagi.");
      console.error(error);
    } finally {
      spinner.classList.add("hidden");
      submitBtn.disabled = false;
    }
  });
</script>
